# Pentecter — Claude Code プロジェクト設定

## プロジェクト概要
自律型ペネトレーションテストエージェント（TUIベース）。
詳細は `docs/architecture.md` および `docs/ui-spec.md` を参照。

---

## Claude Code 作業スタイル

- **メインスレッド = ユーザーとの設計・議論**。実装の詳細はサブエージェント（Task tool）に委譲する。
- 設計方針が決まったら、サブエージェントを並列で起動して実装を進める。
- メインスレッドでは設計レビュー、方針決定、ユーザーからのフィードバック対応に集中する。
- サブエージェントの結果をメインスレッドで要約してユーザーに報告する。

---

## ブランチ戦略（GitHub Flow）

- ブランチモデル: `main` + `feature/*` のみ
- 必ず Issue を作成してからブランチを切る
- ブランチ命名規則: `feature/<issue番号>-<短い説明>` (例: `feature/5-nmap-wrapper`)
- PR は必ず Issue を参照し、マージ時に自動クローズする
  - PR 本文に `Closes #<issue番号>` を含めること
- マージ後もブランチは削除しない（監査証跡のため）

---

## 開発プロセス（TDD）

**すべての実装は以下の順序で行う：**

1. **テストを書く** → 失敗することを確認（Red）
2. **実装を書く** → テストが通ることを確認（Green）
3. **リファクタリング** → テストが引き続き通ることを確認（Refactor）

### 新機能追加サイクル

1. `internal/<package>/<name>_test.go` にユニットテストを書く
2. `internal/<package>/<name>.go` に実装を書く
3. `go test ./internal/<package>/...` がグリーンになること
4. 統合テスト・E2E テストを追加する
5. テストなしで完了宣言禁止

---

## コーディング規約

- エラー処理とセキュリティを最優先（入力バリデーション・ネットワーク関連は特に注意）
- 破壊的操作（削除・強制上書き・プロセス終了）は必ずユーザー確認を取る
- 認証情報・APIキー・シークレットはコードに直接書かない（環境変数または設定ファイルを使用）
- `go vet` と `golangci-lint` が通ること

### push 時のチェックリスト

コードを push する前に以下を実行すること：

```bash
go build ./...          # ビルドが通ること
go vet ./...            # 静的解析が通ること
go test ./internal/...  # ユニットテストがグリーンであること
golangci-lint run       # lint が通ること（CI と同じ）
```

CI は push ごとに自動実行されるが、**事前にローカルで確認してから push すること**。

**重要: 上記チェックがすべて通るまで作業完了としてはならない。特に `golangci-lint run` が通らない限り、コミット・プッシュ禁止。**

---

## アーキテクチャ制約

- Brain（LLM）は OS を直接操作しない。必ずツールラッパー経由で実行する
- TUI の goroutine はブロックしない。重い処理は別 goroutine + channel で通信する
- ターゲットの状態（Logs, Status, Proposal）は `internal/agent.Target` で一元管理する

---

## 攻撃技術の開発サイクル

新しい攻撃技術を追加するときは、以下の順序で実装する：

1. **技術の実装** (`internal/tools/<name>/`)
2. **ユニットテスト** (`internal/tools/<name>/<name>_test.go`) — モックサーバーを使う
3. **やられサーバへ脆弱エンドポイントを追加** (`testenv/`)
4. **統合テスト・E2E テスト** — 実際のツールに対して成功すること

この 4 ステップを踏まずに完了宣言禁止。

## ドキュメントルール

ドキュメントのディレクトリは以下で対応する
1. **設計に関するもの**(`/docs/architecture_design/`)
2. **ツールのマニュアル**(`/docs/`)

このドキュメント構造を守ること。

会話して設計が確定した場合は速やかに`/docs/architecture_design/`へ記載する
