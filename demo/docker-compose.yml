services:
  pentecter:
    build:
      context: ..
      dockerfile: demo/Dockerfile.pentecter
    container_name: pentecter
    stdin_open: true
    tty: true
    env_file:
      - path: .env
        required: false
    networks:
      pentecter-demo:
        ipv4_address: 172.30.0.10
    depends_on:
      target:
        condition: service_healthy

  target:
    image: tleemcjr/metasploitable2:latest
    container_name: pentecter-demo-target
    hostname: metasploitable
    init: true
    command: ["sh", "-c", "/bin/services.sh && tail -f /dev/null"]
    healthcheck:
      test: ["CMD-SHELL", "netstat -tlnp | grep :80 || exit 1"]
      interval: 10s
      timeout: 5s
      retries: 10
      start_period: 30s
    networks:
      pentecter-demo:
        ipv4_address: 172.30.0.20
    deploy:
      resources:
        limits:
          memory: 512M
          cpus: "1.0"

networks:
  pentecter-demo:
    driver: bridge
    ipam:
      config:
        - subnet: 172.30.0.0/24
